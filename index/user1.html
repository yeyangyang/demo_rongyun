<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>融云用户1</title>

<link rel="stylesheet" type="text/css" href="css/qq.css"/>

</head>
<body>

<div class="qqBox">
	<div class="BoxHead">
		<div class="headImg">
			<img src="img/6.jpg"/>
		</div>
		<div class="internetName">90后大叔</div>
	</div>
	<div class="context">
		<div class="conLeft">
			<ul id="dialogue_list">
				<li>
					<div class="liLeft"><img src="img/20170926103645_04.jpg"/></div>
					<div class="liRight">
						<span class="intername">前端交流群</span>
						<span class="infor">厉害了</span>
					</div>
				</li>
				<li class="bg">
					<div class="liLeft"><img src="img/20170926103645_19.jpg"/></div>
					<div class="liRight">
						<span  class="intername">赵鹏</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_27.jpg"/></div>
					<div class="liRight">
						<span  class="intername">web交流群</span>
						<span class="infor">666</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_21.jpg"/></div>
					<div class="liRight">
						<span  class="intername">jquery插件库</span>
						<span class="infor">这个群妹子多</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_23.jpg"/></div>
					<div class="liRight">
						<span  class="intername">我的phone</span>
						<span class="infor">[文件]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_25.jpg"/></div>
					<div class="liRight">
						<span  class="intername">...</span>
						<span class="infor">[么么哒]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_27.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">前端小黑：怎么才能</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_29.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">大西瓜：差评，这个下面又</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_54.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_04.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_19.jpg"/></div>
					<div class="liRight">
						<span  class="intername">赵鹏</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_27.jpg"/></div>
					<div class="liRight">
						<span  class="intername">web交流群</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_21.jpg"/></div>
					<div class="liRight">
						<span  class="intername">jquery插件库</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_23.jpg"/></div>
					<div class="liRight">
						<span  class="intername">我的phone</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_25.jpg"/></div>
					<div class="liRight">
						<span  class="intername">...</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_27.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_29.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
				<li>
					<div class="liLeft"><img src="img/20170926103645_54.jpg"/></div>
					<div class="liRight">
						<span  class="intername">前端交流群</span>
						<span class="infor">[流泪]</span>
					</div>
				</li>
			</ul>
		</div>
		<div class="conRight">
			<div class="Righthead">
				<div class="headName">赵鹏</div>
				<!--<div class="headConfig">
					<ul>
						<li><img src="img/20170926103645_06.jpg"/></li>
						<li><img src="img/20170926103645_08.jpg"/></li>
						<li><img src="img/20170926103645_10.jpg"/></li>
						<li><img src="img/20170926103645_12.jpg"/></li>
					</ul>
				</div>-->
			</div>
			<div class="RightCont">
				<ul class="newsList">
				
				</ul>
			</div>
			<div class="RightFoot">
				<div class="emjon">
					<ul>
						<li><img src="img/em_02.jpg"/></li>
						<li><img src="img/em_05.jpg"/></li>
						<li><img src="img/em_07.jpg"/></li>
						<li><img src="img/em_12.jpg"/></li>
						<li><img src="img/em_14.jpg"/></li>
						<li><img src="img/em_16.jpg"/></li>
						<li><img src="img/em_20.jpg"/></li>
						<li><img src="img/em_23.jpg"/></li>
						<li><img src="img/em_25.jpg"/></li>
						<li><img src="img/em_30.jpg"/></li>
						<li><img src="img/em_31.jpg"/></li>
						<li><img src="img/em_33.jpg"/></li>
						<li><img src="img/em_37.jpg"/></li>
						<li><img src="img/em_38.jpg"/></li>
						<li><img src="img/em_40.jpg"/></li>
						<li><img src="img/em_45.jpg"/></li>
						<li><img src="img/em_47.jpg"/></li>
						<li><img src="img/em_48.jpg"/></li>
						<li><img src="img/em_52.jpg"/></li>
						<li><img src="img/em_54.jpg"/></li>
						<li><img src="img/em_55.jpg"/></li>
					</ul>
				</div>
				<!--<div class="footTop">
					<ul>
						<li><img src="img/20170926103645_31.jpg"/></li>
						<li class="ExP"><img src="img/20170926103645_33.jpg"/></li>
						<li><img src="img/20170926103645_35.jpg"/></li>
						<li><img src="img/20170926103645_37.jpg"/></li>
						<li><img src="img/20170926103645_39.jpg"/></li>
						<li><img src="img/20170926103645_41.jpg" alt="" /></li>
						<li><img src="img/20170926103645_43.jpg"/></li>
						<li><img src="img/20170926103645_45.jpg"/></li>
					</ul>
				</div>-->
				<div class="inputBox">
					<textarea id="dope" style="width: 99%;height: 75px; border: none;outline: none;" name="" rows="" cols=""></textarea>
					<button class="sendBtn">发送(s)</button>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/chat.js"></script>
<script src="http://cdn.ronghub.com/RongIMLib-2.2.5.min.js"></script> 



<script type="text/javascript">
	
$(function(){
	
	RongIMLib.RongIMClient.init("pvxdm17jpis2r");		//初始化 SDK
	


// 设置连接监听状态 （ status 标识当前连接状态 ）
 // 连接状态监听器
 RongIMClient.setConnectionStatusListener({
    onChanged: function (status) {
        switch (status) {
            case RongIMLib.ConnectionStatus.CONNECTED:
                console.log('链接成功');
                break;
            case RongIMLib.ConnectionStatus.CONNECTING:
                console.log('正在链接');
                break;
            case RongIMLib.ConnectionStatus.DISCONNECTED:
                console.log('断开连接');
                break;
            case RongIMLib.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:
                console.log('其他设备登录');
                break;
              case RongIMLib.ConnectionStatus.DOMAIN_INCORRECT:
                console.log('域名不正确');
                break;
            case RongIMLib.ConnectionStatus.NETWORK_UNAVAILABLE:
              console.log('网络不可用');
              break;
            }
    }});

 // 消息监听器
 RongIMClient.setOnReceiveMessageListener({
    // 接收到的消息
    onReceived: function (message) {
    	
    	console.log(message);
    	console.log(message.messageType);
    	
        // 判断消息类型
        switch(message.messageType){
            case RongIMClient.MessageType.TextMessage:
            	alert(message.content.content);
                // message.content.content => 消息内容
                break;
            case RongIMClient.MessageType.VoiceMessage:
                // 对声音进行预加载                
                // message.content.content 格式为 AMR 格式的 base64 码
                break;
            case RongIMClient.MessageType.ImageMessage:
               // message.content.content => 图片缩略图 base64。
               // message.content.imageUri => 原图 URL。
               break;
            case RongIMClient.MessageType.DiscussionNotificationMessage:
               // message.content.extension => 讨论组中的人员。
               break;
            case RongIMClient.MessageType.LocationMessage:
               // message.content.latiude => 纬度。
               // message.content.longitude => 经度。
               // message.content.content => 位置图片 base64。
               break;
            case RongIMClient.MessageType.RichContentMessage:
               // message.content.content => 文本消息内容。
               // message.content.imageUri => 图片 base64。
               // message.content.url => 原图 URL。
               break;
            case RongIMClient.MessageType.InformationNotificationMessage:
                // do something...
               break;
            case RongIMClient.MessageType.ContactNotificationMessage:
                // do something...
               break;
            case RongIMClient.MessageType.ProfileNotificationMessage:
                // do something...
               break;
            case RongIMClient.MessageType.CommandNotificationMessage:
                // do something...
               break;
            case RongIMClient.MessageType.CommandMessage:
                // do something...
               break;
            case RongIMClient.MessageType.UnknownMessage:
                // do something...
               break;
            default:
                // do something...
        }
    }
});


//连接服务器
 var token = "vQD9GF2sSzer5kUxNBTvGb+N+eCjfC+08+/DEaZ1FBRwODyZF3Fu5NzCKvT9xGYcf5QnPywlp687uFyaNwILNQ==";

  	RongIMClient.connect(token, {
        onSuccess: function(userId) {
          console.log("Connect successfully." + userId);
        },
        onTokenIncorrect: function() {
          console.log('token无效');
        },
        onError:function(errorCode){
              var info = '';
              switch (errorCode) {
                case RongIMLib.ErrorCode.TIMEOUT:
                  info = '超时';
                  break;
                case RongIMLib.ConnectionState.UNACCEPTABLE_PAROTOCOL_VERSION:
                  info = '不可接受的协议版本';
                  break;
                case RongIMLib.ConnectionState.IDENTIFIER_REJECTED:
                  info = 'appkey不正确';
                  break;
                case RongIMLib.ConnectionState.SERVER_UNAVAILABLE:
                  info = '服务器不可用';
                  break;
              }
              console.log(errorCode);
            }
      });


});

</script>




<input type="button" name="3" id="3" value="获取会话列表" onclick="dialogue_list();" />


<!-- 会话接口 -->
<script type="text/javascript">

/* 获取会话列表 */
function dialogue_list(){
	let limit = 20; //获取会话的数量，不传或传null为全部，暂不支持分页

	RongIMClient.getInstance().getConversationList({
	  onSuccess: function(list) {
	  	console.log(list);
	    // list => 会话列表集合。
		var userList = "";
		var content = "";
		var name = "";
		var img = "";
		var onclass;
		for(var i=0; i<list.length; i++){
			console.log(list[i].targetId);
			console.log(list[i].latestMessage.content.content);
			console.log(list[i].latestMessage.content.content);
			console.log(list[i].latestMessage.content.content);
			//通过用户id进行ajax交互，获取用户头像和昵称
			
			//这里是组装html
			img = "img/20170926103645_04.jpg";
			name = "叶洋洋";
			content = list[i].latestMessage.content.content;
			
			if(i==0){
				onclass = 'class="bg"';
			}else{
				onclass = '';
			}
			userList += '<li '+onclass+'>'+'<div class="liLeft"><img src="'+img+'"></div>'+'<div class="liRight">'+'<span class="intername">'+name+'</span>'+'<span class="infor">'+content+'</span></div></li>';
			$(".context .conLeft #dialogue_list").html(userList);
			
			
		}
		
		
		var aa = $(".context .conLeft #dialogue_list").html();
		//console.log(aa);
		
		//这里是组装html
		var img = "img/20170926103645_04.jpg";
		var name = "叶洋洋";
		var content = "666";
		
		
		var userList = '<li>'+'<div class="liLeft"><img src="'+img+'"></div>'+'<div class="liRight">'+'<span class="intername">'+name+'</span>'+'<span class="infor">'+content+'</span></div></li>';
		
	  },
	  onError: function(error) {
	  	console.log("errorcode: " + error);
	     // do something...
	  }
	},null,limit);
}


/* 删除指定会话 */
function dialogue_del(){
	RongIMClient.getInstance().removeConversation(RongIMLib.ConversationType.PRIVATE, 'userId2', { 
		onSuccess:function(result){ 
            //showResult("删除会话成功",result,start);
		}, 
		onError:function(error){ 
		// error => 清除会话错误码。 
		    //showResult("删除会话失败",error,start);
		} 
	});
}

/* 删除所有会话 */
function dialogue_del_q(){
	RongIMClient.getInstance().clearConversations({
	    onSuccess:function(){
	      // 清除会话成功
	    },
	    onError:function(error){
	      // error => 清除会话错误码。
	    }
	});
}


</script>




</body>
</html>